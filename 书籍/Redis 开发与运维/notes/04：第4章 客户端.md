---
title: ç¬¬4ç«  å®¢æˆ·ç«¯
hidden: true
date: 2021-09-21
updated: 2021-09-21
---

# ç¬¬4ç«  å®¢æˆ·ç«¯

## 4.1 å®¢æˆ·ç«¯é€šä¿¡åè®®

| ğŸ’¡ **é€šä¿¡åè®®** |
| -------------- |

RESPï¼ˆREdis Serialization Protocolï¼ŒRedis åºåˆ—åŒ–åè®®ï¼‰

å‘é€å‘½ä»¤æ ¼å¼ï¼š

```shell
*<å‚æ•°æ•°é‡> CRLF
$<å‚æ•°1çš„å­—èŠ‚æ•°é‡> CRLF
<å‚æ•°1> CRLF
...
$<å‚æ•°Nçš„å­—èŠ‚æ•°é‡> CRLF
<å‚æ•°N> CRLF
```

è¿”å›ç»“æœæ ¼å¼ï¼š

-   çŠ¶æ€å›å¤ï¼šç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º"+"
-   é”™è¯¯å›å¤ï¼šç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º"-"
-   æ•´æ•°å›å¤ï¼šç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º":"
-   å­—ç¬¦ä¸²å›å¤ï¼šç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º"$"
-   å¤šæ¡å­—ç¬¦ä¸²å›å¤ï¼šç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º"*"

## 4.2 Javaå®¢æˆ·ç«¯Jedis

| ğŸ’¡ **Jedis çš„ä½¿ç”¨** |
| ------------------ |

### 4.2.1 è·å–Jedis

ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>${jedis.version}</version>
</dependency>
```

### 4.2.2 Jedisçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•

```java
Jedis jedis = new Jedis("127.0.0.1", 6379);
jedis.set("hello", "world");
...
```

### 4.2.3 Jedisè¿æ¥æ± çš„ä½¿ç”¨æ–¹æ³•

```java
// common-poolè¿æ¥æ± é…ç½®ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤é…ç½®ï¼Œåé¢å°èŠ‚ä¼šä»‹ç»å…·ä½“é…ç½®è¯´æ˜
GenericObjectPoolConfig poolConfig = new GenericObjectPoolConfig();
// è®¾ç½®æœ€å¤§è¿æ¥æ•°ä¸ºé»˜è®¤å€¼çš„5å€
poolConfig.setMaxTotal(GenericObjectPoolConfig.DEFAULT_MAX_TOTAL * 5);
// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°ä¸ºé»˜è®¤å€¼çš„3å€
poolConfig.setMaxIdle(GenericObjectPoolConfig.DEFAULT_MAX_IDLE * 3);
// è®¾ç½®æœ€å°ç©ºé—²è¿æ¥æ•°ä¸ºé»˜è®¤å€¼çš„2å€
poolConfig.setMinIdle(GenericObjectPoolConfig.DEFAULT_MIN_IDLE * 2);
// è®¾ç½®å¼€å¯jmxåŠŸèƒ½
poolConfig.setJmxEnabled(true);
// è®¾ç½®è¿æ¥æ± æ²¡æœ‰è¿æ¥åå®¢æˆ·ç«¯çš„æœ€å¤§ç­‰å¾…æ—¶é—´(å•ä½ä¸ºæ¯«ç§’)
poolConfig.setMaxWaitMillis(3000);
// åˆå§‹åŒ–Jedisè¿æ¥æ± 
JedisPool jedisPool = new JedisPool(poolConfig, "127.0.0.1", 6379);
// ä»è¿æ¥æ± è·å–jediså¯¹è±¡
Jedis jedis = jedisPool.getResource();
```

<center><i>è¡¨ 4-2 GenericObjectPoolConfig çš„é‡è¦å±æ€§</i></center>

| å‚æ•°å                        | å«ä¹‰                                                         | é»˜è®¤å€¼                       |
| ----------------------------- | ------------------------------------------------------------ | ---------------------------- |
| maxActive                     | è¿æ¥æ± ä¸­æœ€å¤§è¿æ¥æ•°                                           | 8                            |
| maxIdle                       | è¿æ¥æ± ä¸­æœ€å¤§ç©ºé—²çš„è¿æ¥æ•°                                     | 8                            |
| minIdle                       | è¿æ¥æ± ä¸­æœ€å°‘ç©ºé—²çš„è¿æ¥æ•°                                     | 0                            |
| maxwaitMillis                 | å½“è¿æ¥æ± èµ„æºç”¨å°½åï¼Œè°ƒç”¨è€…çš„æœ€å¤§ç­‰å¾… æ—¶é—´ï¼ˆå•ä½ä¸ºæ¯«ç§’)ï¼Œä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨é»˜è®¤å€¼ | -1:è¡¨ç¤ºæ°¸è¿œä¸è¶… æ—¶ï¼Œä¸€ç›´ç­‰ã€‚ |
| jmxEnabled                    | æ˜¯å¦å¼€å¯jmxç›‘æ§ï¼Œå¦‚æœåº”ç”¨å¼€å¯äº†jrmx ç«¯å£å¹¶ä¸”jmxEnabledè®¾ç½®ä¸ºtrueï¼Œå°±å¯ ä»¥é€šè¿‡jconsoleæˆ–è€…jvisualvmçœ‹åˆ°å…³ äºè¿æ¥æ± çš„ç›¸å…³ç»Ÿè®¡ï¼Œæœ‰åŠ©äºäº†è§£è¿æ¥æ± çš„ ä½¿ç”¨æƒ…å†µ,å¹¶ä¸”å¯ä»¥é’ˆå¯¹å…¶åšç›‘æ§ç»Ÿè®¡ã€‚ | true                         |
| minEvictableIdleTimeMillis    | è¿æ¥çš„æœ€å°ç©ºé—²æ—¶é—´ï¼Œè¾¾åˆ°æ­¤å€¼åç©ºé—²è¿ æ¥å°†è¢«ç§»é™¤              | 1000LÃ— 60LÃ— 30 æ¯«ç§’=30åˆ†é’Ÿ   |
| numTestsPerEvictionRun        | åšç©ºé—²è¿æ¥æ£€æµ‹æ—¶ï¼Œæ¯æ¬¡çš„é‡‡æ ·æ•°                               | 3                            |
| testOnBorrow                  | å‘è¿æ¥æ± å€Ÿç”¨è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥æœ‰æ•ˆæ€§æ£€ æµ‹( ping)ï¼Œæ— æ•ˆè¿æ¥ä¼šè¢«ç§»é™¤ï¼Œæ¯æ¬¡å€Ÿç”¨å¤š æ‰§è¡Œä¸€æ¬¡pingå‘½ä»¤ | false                        |
| testOnReturn                  | å‘è¿æ¥æ± å½’è¿˜è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥æœ‰æ•ˆæ€§æ£€ æµ‹( ping)ï¼Œæ— æ•ˆè¿æ¥ä¼šè¢«ç§»é™¤,æ¯æ¬¡å½’è¿˜å¤š æ‰§è¡Œä¸€æ¬¡pingå‘½ä»¤ | false                        |
| testwhileIdle                 | å‘è¿æ¥æ± å€Ÿç”¨è¿æ¥æ—¶æ˜¯å¦åšè¿æ¥ç©ºé—²æ£€æµ‹, ç©ºé—²è¶…æ—¶çš„è¿æ¥ä¼šè¢«ç§»é™¤ | false                        |
| timeBetweenEvictionRunsMillis | ç©ºé—²è¿æ¥çš„æ£€æµ‹å‘¨æœŸï¼ˆå•ä½ä¸ºæ¯«ç§’)                              | -1:è¡¨ç¤ºä¸åšæ£€æµ‹              |
| blockwhenExhausted            | å½“è¿æ¥æ± ç”¨å°½åï¼Œè°ƒç”¨è€…æ˜¯å¦è¦ç­‰å¾…ï¼Œè¿™ä¸ª å‚æ•°æ˜¯å’ŒmaxwaitMilliså¯¹åº”çš„ï¼Œåªæœ‰å½“æ­¤ å‚æ•°ä¸ºtrueæ—¶ï¼ŒmaxwaitMillisæ‰ä¼šç”Ÿæ•ˆ | true                         |

### 4.2.4 Redisä¸­Pipelineçš„ä½¿ç”¨æ–¹æ³•

```java
Pipeline pipeline = jedis.pipelined();
pipeline.set("hello", "world");
pipeline.incr("counter");
List<Object> resultList = pipeline.syncAndReturnAll();
```

### 4.2.5 Jedisçš„Luaè„šæœ¬

```java
// eval
String key = "hello";
String script = "return redis.call('get',KEYS[1])";
Object result = jedis.eval(script, 1, key);

// evalsha
String scriptSha = jedis.scriptLoad(script);
String key = "hello";
Object result = jedis.evalsha(scriptSha, 1, key);
```

## 4.3 Pythonå®¢æˆ·ç«¯redis-py â±

### 4.3.1 è·å–redis-py

### 4.3.2 redis-pyçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•

### 4.3.3 redis-pyä¸­Pipelineçš„ä½¿ç”¨æ–¹æ³•

### 4.3.4 redis-pyä¸­çš„Luaè„šæœ¬ä½¿ç”¨æ–¹æ³•

## 4.4 å®¢æˆ·ç«¯ç®¡ç† â±

### 4.4.1 å®¢æˆ·ç«¯API

### 4.4.2 å®¢æˆ·ç«¯ç›¸å…³é…ç½®

### 4.4.3 å®¢æˆ·ç«¯ç»Ÿè®¡ç‰‡æ®µ

## 4.5 å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸ â±

## 4.6 å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ â±

### 4.6.1 Rediså†…å­˜é™¡å¢

### 4.6.2 å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶

## 4.7 æœ¬ç« é‡ç‚¹å›é¡¾
